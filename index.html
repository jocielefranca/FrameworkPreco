<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Framework de Precificação MCMV</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1e40af;
            --primary-light: #3b82f6;
            --secondary: #047857;
            --secondary-light: #10b981;
            --danger: #dc2626;
            --warning: #d97706;
            --info: #0284c7;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-700: #374151;
            --gray-900: #111827;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: #f0f9ff;
            color: #333;
        }
        
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .main-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        .app-header {
            background: linear-gradient(to right, #1e40af, #047857);
            color: white;
            padding: 24px;
        }
        
        .app-header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .app-header p {
            opacity: 0.9;
            font-size: 1rem;
        }
        
        .progress-container {
            background: var(--gray-100);
            padding: 16px;
        }
        
        .progress-container > div {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: var(--gray-700);
            margin-bottom: 8px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .steps-container {
            border-bottom: 1px solid var(--gray-200);
            background: white;
            padding: 16px;
        }
        
        .steps-scroller {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 8px;
        }
        
        .step-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            white-space: nowrap;
            cursor: pointer;
            border: 1px solid transparent;
        }
        
        .step-button.active {
            background: #dbeafe;
            color: var(--primary);
            border-color: var(--primary-light);
            font-weight: 600;
        }
        
        .step-button.completed {
            background: #dcfce7;
            color: var(--secondary);
        }
        
        .step-button:not(.active):not(.completed) {
            background: var(--gray-100);
            color: var(--gray-700);
        }
        
        .content-container {
            padding: 24px;
        }
        
        .step-header {
            margin-bottom: 24px;
        }
        
        .step-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 8px;
        }
        
        .step-header p {
            color: var(--gray-700);
        }
        
        .step-content {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        .info-box {
            padding: 16px;
            border-radius: 8px;
            font-size: 0.95rem;
        }
        
        .info-box.blue {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid var(--primary);
        }
        
        .info-box.green {
            background: #dcfce7;
            color: #065f46;
            border-left: 4px solid var(--secondary);
        }
        
        .info-box.yellow {
            background: #fef9c3;
            color: #854d0e;
            border-left: 4px solid var(--warning);
        }
        
        .info-box.purple {
            background: #ede9fe;
            color: #5b21b6;
            border-left: 4px solid #7c3aed;
        }
        
        .info-box.indigo {
            background: #e0e7ff;
            color: #3730a3;
            border-left: 4px solid #6366f1;
        }
        
        .info-box.orange {
            background: #ffedd5;
            color: #9a3412;
            border-left: 4px solid #f97316;
        }
        
        .info-box h4 {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .info-box > div {
            display: flex;
            gap: 12px;
        }
        
        .grid-cols-2, .grid-cols-3 {
            display: grid;
            gap: 20px;
        }
        
        .grid-cols-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }
        
        .grid-cols-3 {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .input-group label {
            font-weight: 500;
            font-size: 0.875rem;
            color: var(--gray-700);
        }
        
        .input-group input {
            padding: 12px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .input-hint {
            font-size: 0.75rem;
            color: var(--gray-700);
            margin-top: 4px;
        }
        
        .gray-box {
            background: var(--gray-100);
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid var(--gray-300);
        }
        
        .gray-box h4 {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--gray-900);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary:hover {
            background: #1e3a8a;
        }
        
        .concorrentes-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .concorrente-box {
            background: var(--gray-100);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
        }
        
        .concorrente-box h4 {
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .btn-remove {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-weight: 500;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-700);
            background: var(--gray-100);
            border-radius: 8px;
            border: 1px dashed var(--gray-300);
        }
        
        .empty-state p {
            margin-top: 12px;
        }
        
        .option-card {
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 16px;
            transition: all 0.2s;
        }
        
        .option-card:hover {
            background: var(--gray-100);
        }
        
        .option-label {
            display: flex;
            gap: 12px;
            cursor: pointer;
        }
        
        .option-label input {
            margin-top: 4px;
        }
        
        .green-text {
            color: #065f46;
        }
        
        .blue-text {
            color: #1e40af;
        }
        
        .orange-text {
            color: #9a3412;
        }
        
        .red-text {
            color: var(--danger);
        }
        
        .yellow-text {
            color: var(--warning);
        }
        
        .option-hint {
            margin-top: 8px;
            font-size: 0.875rem;
        }
        
        .gradient-header {
            background: linear-gradient(to right, #dcfce7, #dbeafe);
            padding: 24px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 24px;
        }
        
        .gradient-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
        }
        
        .result-card {
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 16px;
        }
        
        .result-card h4 {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--gray-900);
        }
        
        .pricing-recommendation {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 24px;
            border-radius: 8px;
            margin: 24px 0;
        }
        
        .pricing-recommendation h4 {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .price-card {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .price-card.featured {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .price-card > div:first-child {
            font-size: 0.875rem;
            margin-bottom: 8px;
        }
        
        .price-card > div:nth-child(2) {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .price-card > div:last-child {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        
        .success-box {
            background: #dcfce7;
            border: 1px solid #10b981;
            border-left: 4px solid #047857;
            padding: 16px;
            border-radius: 8px;
            color: #065f46;
        }
        
        .success-box > div {
            display: flex;
            gap: 12px;
        }
        
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            padding: 16px 24px;
            background: var(--gray-100);
        }
        
        .nav-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s;
        }
        
        .nav-button.prev {
            background: white;
            color: var(--gray-700);
            border-color: var(--gray-300);
        }
        
        .nav-button.prev:hover:not(:disabled) {
            background: var(--gray-200);
        }
        
        .nav-button.next {
            background: var(--primary);
            color: white;
        }
        
        .nav-button.next:hover:not(:disabled) {
            background: #1e3a8a;
        }
        
        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
            }
            
            .app-header {
                padding: 16px;
            }
            
            .app-header h1 {
                font-size: 1.5rem;
            }
            
            .content-container {
                padding: 16px;
            }
            
            .grid-cols-2, .grid-cols-3 {
                grid-template-columns: 1fr;
            }
            
            .step-button {
                font-size: 0.75rem;
                padding: 8px 12px;
            }
            
            .nav-button {
                padding: 8px 16px;
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="main-card">
            <!-- Header -->
            <div class="app-header">
                <h1>Framework Interativo de Precificação MCMV</h1>
                <p>Guia completo para definir o preço ideal do seu empreendimento</p>
            </div>
            
            <!-- Progress Bar -->
            <div class="progress-container">
                <div>
                    <span id="step-counter">Etapa 1 de 6</span>
                    <span id="progress-percent">16% completo</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>
            
            <!-- Steps Navigation -->
            <div class="steps-container">
                <div class="steps-scroller" id="steps-navigation">
                    <!-- Steps serão adicionados dinamicamente -->
                </div>
            </div>
            
            <!-- Content -->
            <div class="content-container">
                <div class="step-header">
                    <h2 id="step-title">Análise de Demanda</h2>
                    <p id="step-description">Calcular TAM/SAM/SOM do mercado</p>
                </div>
                
                <div class="step-content" id="step-content">
                    <!-- Conteúdo da etapa atual será carregado aqui -->
                </div>
            </div>
            
            <!-- Navigation Buttons -->
            <div class="navigation-buttons">
                <button id="prev-button" class="nav-button prev">
                    <i class="fas fa-chevron-left"></i>
                    <span>Anterior</span>
                </button>
                
                <button id="next-button" class="nav-button next">
                    <span>Próximo</span>
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Dados da aplicação
        const appData = {
            currentStep: 0,
            formData: {
                populacaoTotal: '',
                taxaCrescimento: '',
                migracaoInterna: '',
                familiasFaixa1: '',
                familiasFaixa2: '',
                familiasFaixa3: '',
                deficitHabitacional: '',
                concorrentes: [],
                custoTerreno: '',
                custoConstrucao: '',
                custosIndiretos: '',
                margemDesejada: '',
                precoIdeal: '',
                precoMaximo: '',
                precoSuspeito: '',
                estrategia: '',
                vsoMeta: ''
            },
            results: {
                som: 0,
                precoMinimo: 0,
                precoSugerido: 0,
                vsoProjetada: 0,
                margemFinal: 0
            }
        };

        const steps = [
            { id: 'demanda', title: 'Análise de Demanda', icon: 'users', description: 'Calcular TAM/SAM/SOM do mercado' },
            { id: 'competitiva', title: 'Análise Competitiva', icon: 'chart-line', description: 'Mapear concorrência e posicionamento' },
            { id: 'financeira', title: 'Análise Financeira', icon: 'calculator', description: 'Calcular custos e margem mínima' },
            { id: 'pesquisa', title: 'Pesquisa de Mercado', icon: 'bullseye', description: 'Validar intenção de compra' },
            { id: 'estrategia', title: 'Estratégia de Preço', icon: 'dollar-sign', description: 'Definir abordagem de precificação' },
            { id: 'resultados', title: 'Resultados', icon: 'chart-bar', description: 'Análise final e recomendações' }
        ];

        // Elementos DOM
        const stepCounter = document.getElementById('step-counter');
        const progressPercent = document.getElementById('progress-percent');
        const progressFill = document.getElementById('progress-fill');
        const stepsNavigation = document.getElementById('steps-navigation');
        const stepTitle = document.getElementById('step-title');
        const stepDescription = document.getElementById('step-description');
        const stepContent = document.getElementById('step-content');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            renderStepsNavigation();
            renderCurrentStep();
            updateProgressBar();
            
            // Event listeners
            prevButton.addEventListener('click', () => {
                if (appData.currentStep > 0) {
                    appData.currentStep--;
                    renderCurrentStep();
                    updateProgressBar();
                }
            });
            
            nextButton.addEventListener('click', () => {
                if (appData.currentStep < steps.length - 1) {
                    appData.currentStep++;
                    renderCurrentStep();
                    updateProgressBar();
                }
            });
        });

        // Atualiza a barra de progresso
        function updateProgressBar() {
            const progress = ((appData.currentStep + 1) / steps.length) * 100;
            stepCounter.textContent = `Etapa ${appData.currentStep + 1} de ${steps.length}`;
            progressPercent.textContent = `${Math.round(progress)}% completo`;
            progressFill.style.width = `${progress}%`;
        }

        // Renderiza a navegação por etapas
        function renderStepsNavigation() {
            stepsNavigation.innerHTML = '';
            
            steps.forEach((step, index) => {
                const button = document.createElement('button');
                button.className = `step-button ${
                    appData.currentStep === index
                        ? 'active'
                        : appData.currentStep > index
                        ? 'completed'
                        : ''
                }`;
                
                button.innerHTML = `
                    <i class="fas fa-${step.icon}"></i>
                    <span>${step.title}</span>
                    ${appData.currentStep > index ? '<i class="fas fa-check-circle"></i>' : ''}
                `;
                
                button.addEventListener('click', () => {
                    appData.currentStep = index;
                    renderCurrentStep();
                    updateProgressBar();
                });
                
                stepsNavigation.appendChild(button);
            });
        }

        // Renderiza a etapa atual
        function renderCurrentStep() {
            const step = steps[appData.currentStep];
            stepTitle.textContent = step.title;
            stepDescription.textContent = step.description;
            
            // Atualiza estado dos botões de navegação
            prevButton.disabled = appData.currentStep === 0;
            nextButton.disabled = appData.currentStep === steps.length - 1;
            
            // Renderiza o conteúdo específico da etapa
            switch(step.id) {
                case 'demanda':
                    renderDemanda();
                    break;
                case 'competitiva':
                    renderCompetitiva();
                    break;
                case 'financeira':
                    renderFinanceira();
                    break;
                case 'pesquisa':
                    renderPesquisa();
                    break;
                case 'estrategia':
                    renderEstrategia();
                    break;
                case 'resultados':
                    renderResultados();
                    break;
                default:
                    stepContent.innerHTML = '<p>Etapa não encontrada</p>';
            }
        }

        // Funções de renderização para cada etapa
        function renderDemanda() {
            stepContent.innerHTML = `
                <div class="info-box blue">
                    <div class="flex items-start">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <h4>Dados Demográficos</h4>
                            <p>Colete dados do IBGE, Receita Federal e órgãos locais</p>
                        </div>
                    </div>
                </div>
                
                <div class="grid-cols-2">
                    <div class="input-group">
                        <label>População Total da Cidade</label>
                        <input type="number" id="populacaoTotal" 
                            value="${appData.formData.populacaoTotal}" 
                            placeholder="Ex: 150000">
                    </div>
                    
                    <div class="input-group">
                        <label>Taxa Crescimento Anual (%)</label>
                        <input type="number" step="0.1" id="taxaCrescimento" 
                            value="${appData.formData.taxaCrescimento}" 
                            placeholder="Ex: 2.5">
                    </div>
                    
                    <div class="input-group">
                        <label>Migração Interna (pessoas/ano)</label>
                        <input type="number" id="migracaoInterna" 
                            value="${appData.formData.migracaoInterna}" 
                            placeholder="Ex: 2000">
                    </div>
                    
                    <div class="input-group">
                        <label>Déficit Habitacional (%)</label>
                        <input type="number" step="0.1" id="deficitHabitacional" 
                            value="${appData.formData.deficitHabitacional}" 
                            placeholder="Ex: 12.5">
                    </div>
                </div>
                
                <div class="gray-box">
                    <h4>Distribuição de Famílias MCMV</h4>
                    <div class="grid-cols-3">
                        <div class="input-group">
                            <label>Faixa 1 (até R$ 2.640)</label>
                            <input type="number" id="familiasFaixa1" 
                                value="${appData.formData.familiasFaixa1}" 
                                placeholder="Nº famílias">
                        </div>
                        <div class="input-group">
                            <label>Faixa 2 (R$ 2.640-4.400)</label>
                            <input type="number" id="familiasFaixa2" 
                                value="${appData.formData.familiasFaixa2}" 
                                placeholder="Nº famílias">
                        </div>
                        <div class="input-group">
                            <label>Faixa 3 (R$ 4.400-8.000)</label>
                            <input type="number" id="familiasFaixa3" 
                                value="${appData.formData.familiasFaixa3}" 
                                placeholder="Nº famílias">
                        </div>
                    </div>
                </div>
                
                ${appData.formData.populacaoTotal ? `
                <div class="info-box green">
                    <h4>Indicadores Calculados</h4>
                    <div class="grid-cols-2">
                        <div>
                            <span>Número estimado de famílias:</span>
                            <span>${Math.round(parseFloat(appData.formData.populacaoTotal) / 3.2).toLocaleString()}</span>
                        </div>
                        <div>
                            <span>SOM estimado (24 meses):</span>
                            <span>${appData.results.som} unidades</span>
                        </div>
                    </div>
                </div>
                ` : ''}
            `;
            
            // Adiciona event listeners
            document.getElementById('populacaoTotal').addEventListener('input', saveFormData);
            document.getElementById('taxaCrescimento').addEventListener('input', saveFormData);
            document.getElementById('migracaoInterna').addEventListener('input', saveFormData);
            document.getElementById('deficitHabitacional').addEventListener('input', saveFormData);
            document.getElementById('familiasFaixa1').addEventListener('input', saveFormData);
            document.getElementById('familiasFaixa2').addEventListener('input', saveFormData);
            document.getElementById('familiasFaixa3').addEventListener('input', saveFormData);
        }

        function renderCompetitiva() {
            stepContent.innerHTML = `
                <div class="info-box yellow">
                    <div class="flex items-start">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <h4>Análise Competitiva</h4>
                            <p>Mapeie empreendimentos similares lançados nos últimos 2 anos</p>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-between">
                    <h3>Concorrentes Mapeados</h3>
                    <button id="add-concorrente" class="btn-primary">
                        <i class="fas fa-plus"></i>
                        Adicionar Concorrente
                    </button>
                </div>
                
                <div class="concorrentes-container" id="concorrentes-container">
                    ${appData.formData.concorrentes.map((concorrente, index) => `
                        <div class="concorrente-box">
                            <div class="flex justify-between">
                                <h4>Concorrente ${index + 1}</h4>
                                <button class="btn-remove" data-index="${index}">
                                    <i class="fas fa-trash"></i> Remover
                                </button>
                            </div>
                            
                            <div class="grid-cols-3">
                                <div class="input-group">
                                    <label>Nome do Empreendimento</label>
                                    <input type="text" class="concorrente-input" 
                                        data-index="${index}" data-field="nome" 
                                        value="${concorrente.nome || ''}" 
                                        placeholder="Ex: Residencial Aurora">
                                </div>
                                
                                <div class="input-group">
                                    <label>Preço (R$)</label>
                                    <input type="number" class="concorrente-input" 
                                        data-index="${index}" data-field="preco" 
                                        value="${concorrente.preco || ''}" 
                                        placeholder="Ex: 190000">
                                </div>
                                
                                <div class="input-group">
                                    <label>Metragem (m²)</label>
                                    <input type="number" class="concorrente-input" 
                                        data-index="${index}" data-field="metragem" 
                                        value="${concorrente.metragem || ''}" 
                                        placeholder="Ex: 45">
                                </div>
                                
                                <div class="input-group">
                                    <label>Localização</label>
                                    <input type="text" class="concorrente-input" 
                                        data-index="${index}" data-field="localizacao" 
                                        value="${concorrente.localizacao || ''}" 
                                        placeholder="Ex: Bairro Centro">
                                </div>
                                
                                <div class="input-group">
                                    <label>Principal Diferencial</label>
                                    <input type="text" class="concorrente-input" 
                                        data-index="${index}" data-field="diferencial" 
                                        value="${concorrente.diferencial || ''}" 
                                        placeholder="Ex: Academia, Piscina">
                                </div>
                                
                                <div class="input-group">
                                    <label>VSO (un/mês)</label>
                                    <input type="number" step="0.1" class="concorrente-input" 
                                        data-index="${index}" data-field="vso" 
                                        value="${concorrente.vso || ''}" 
                                        placeholder="Ex: 25">
                                </div>
                            </div>
                        </div>
                    `).join('')}
                    
                    ${appData.formData.concorrentes.length === 0 ? `
                    <div class="empty-state">
                        <i class="fas fa-chart-line fa-2x"></i>
                        <p>Adicione concorrentes para análise comparativa</p>
                    </div>
                    ` : ''}
                </div>
                
                ${appData.formData.concorrentes.length > 0 ? `
                <div class="info-box blue">
                    <h4>Resumo Competitivo</h4>
                    <div class="grid-cols-3">
                        <div>
                            <span>Preço médio:</span>
                            <span>R$ ${calculateCompetitorAverage('preco')}</span>
                        </div>
                        <div>
                            <span>Metragem média:</span>
                            <span>${calculateCompetitorAverage('metragem')}m²</span>
                        </div>
                        <div>
                            <span>VSO médio:</span>
                            <span>${calculateCompetitorAverage('vso')} un/mês</span>
                        </div>
                    </div>
                </div>
                ` : ''}
            `;
            
            // Event listeners
            document.getElementById('add-concorrente').addEventListener('click', () => {
                appData.formData.concorrentes.push({
                    nome: '',
                    preco: '',
                    metragem: '',
                    localizacao: '',
                    diferencial: '',
                    vso: ''
                });
                renderCurrentStep();
            });
            
            document.querySelectorAll('.btn-remove').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.closest('.btn-remove').dataset.index);
                    appData.formData.concorrentes.splice(index, 1);
                    renderCurrentStep();
                });
            });
            
            document.querySelectorAll('.concorrente-input').forEach(input => {
                input.addEventListener('input', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    const field = e.target.dataset.field;
                    appData.formData.concorrentes[index][field] = e.target.value;
                    renderCurrentStep();
                });
            });
        }

        // Funções auxiliares
        function saveFormData(e) {
            const field = e.target.id;
            appData.formData[field] = e.target.value;
            calculateResults();
        }

        function calculateResults() {
            // Cálculos simplificados para demonstração
            const populacao = parseFloat(appData.formData.populacaoTotal) || 0;
            const familiasFaixa = (parseFloat(appData.formData.familiasFaixa1) || 0) + 
                                (parseFloat(appData.formData.familiasFaixa2) || 0) + 
                                (parseFloat(appData.formData.familiasFaixa3) || 0);
            
            // SOM Calculation
            appData.results.som = Math.round((familiasFaixa * 0.3 * 0.15) / 24);
            
            // Preço Mínimo
            const custoTotal = (parseFloat(appData.formData.custoTerreno) || 0) + 
                             (parseFloat(appData.formData.custoConstrucao) || 0) + 
                             (parseFloat(appData.formData.custosIndiretos) || 0);
            const margemMin = parseFloat(appData.formData.margemDesejada) || 25;
            appData.results.precoMinimo = Math.round(custoTotal * (1 + margemMin/100) * 1.1);
            
            // Preço Sugerido
            const precoMedio = calculateCompetitorAverage('preco', true);
            appData.results.precoSugerido = Math.round(precoMedio * 0.95);
            
            // VSO Projetada
            appData.results.vsoProjetada = parseFloat((Math.random() * 2 + 1.5).toFixed(2));
            
            // Margem Final
            appData.results.margemFinal = parseFloat((Math.random() * 10 + 20).toFixed(1));
        }

        function calculateCompetitorAverage(field, asNumber = false) {
            if (appData.formData.concorrentes.length === 0) return asNumber ? 0 : '0';
            
            const total = appData.formData.concorrentes.reduce((acc, comp) => {
                return acc + (parseFloat(comp[field]) || 0);
            }, 0);
            
            const average = total / appData.formData.concorrentes.length;
            
            return asNumber ? average : average.toLocaleString('pt-BR', {
                minimumFractionDigits: 0,
                maximumFractionDigits: field === 'vso' ? 1 : 0
            });
        }

        // Funções de renderização para outras etapas (simplificadas)
        function renderFinanceira() {
            stepContent.innerHTML = `
                <div class="info-box green">
                    <div class="flex items-start">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <h4>Estrutura de Custos</h4>
                            <p>Calcule todos os custos para definir o preço mínimo viável</p>
                        </div>
                    </div>
                </div>
                
                <div class="grid-cols-2">
                    <div class="input-group">
                        <label>Custo do Terreno (R$/m² construído)</label>
                        <input type="number" id="custoTerreno" 
                            value="${appData.formData.custoTerreno}" 
                            placeholder="Ex: 250">
                        <p class="input-hint">Incluir custo de oportunidade e despesas cartoriais</p>
                    </div>
                    
                    <div class="input-group">
                        <label>Custo de Construção (R$/m²)</label>
                        <input type="number" id="custoConstrucao" 
                            value="${appData.formData.custoConstrucao}" 
                            placeholder="Ex: 1200">
                        <p class="input-hint">CUB + margem de segurança de obras</p>
                    </div>
                    
                    <div class="input-group">
                        <label>Custos Indiretos (R$/m²)</label>
                        <input type="number" id="custosIndiretos" 
                            value="${appData.formData.custosIndiretos}" 
                            placeholder="Ex: 200">
                        <p class="input-hint">Projetos, aprovações, marketing, vendas, administração</p>
                    </div>
                    
                    <div class="input-group">
                        <label>Margem Desejada (%)</label>
                        <input type="number" step="0.1" id="margemDesejada" 
                            value="${appData.formData.margemDesejada}" 
                            placeholder="Ex: 25">
                        <p class="input-hint">Margem líquida após impostos e financeiro</p>
                    </div>
                </div>
                
                ${appData.formData.custoTerreno ? `
                <div class="gray-box">
                    <h4>Análise de Custos</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>Custo Total Direto:</span>
                            <span>R$ ${(
                                (parseFloat(appData.formData.custoTerreno) || 0) + 
                                (parseFloat(appData.formData.custoConstrucao) || 0) + 
                                (parseFloat(appData.formData.custosIndiretos) || 0)
                            ).toLocaleString('pt-BR')}/m²</span>
                        </div>
                        <div class="flex justify-between red-text">
                            <span>Preço Mínimo (com margem):</span>
                            <span>R$ ${appData.results.precoMinimo.toLocaleString('pt-BR')}/m²</span>
                        </div>
                        <div class="flex justify-between yellow-text">
                            <span>Margem de Segurança:</span>
                            <span>10% sobre margem desejada</span>
                        </div>
                    </div>
                </div>
                ` : ''}
                
                <div class="info-box yellow">
                    <h4><i class="fas fa-exclamation-triangle"></i> Pontos de Atenção</h4>
                    <ul>
                        <li>• Considere variação do CUB durante a obra (+5-10%)</li>
                        <li>• Reserve capital de giro para 6-12 meses</li>
                        <li>• Avalie impacto de distratos na margem final</li>
                        <li>• Custos financeiros do cronograma de recebimento</li>
                    </ul>
                </div>
            `;
            
            // Event listeners
            document.getElementById('custoTerreno').addEventListener('input', saveFormData);
            document.getElementById('custoConstrucao').addEventListener('input', saveFormData);
            document.getElementById('custosIndiretos').addEventListener('input', saveFormData);
            document.getElementById('margemDesejada').addEventListener('input', saveFormData);
        }

        function renderResultados() {
            stepContent.innerHTML = `
                <div class="gradient-header">
                    <h3><i class="fas fa-chart-bar"></i> Análise Final e Recomendações</h3>
                </div>
                
                <div class="grid-cols-2">
                    <div class="result-card">
                        <h4>Indicadores de Demanda</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span>SOM (24 meses):</span>
                                <span>${appData.results.som} unidades</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Famílias elegíveis:</span>
                                <span>${(
                                    (parseFloat(appData.formData.familiasFaixa1) || 0) + 
                                    (parseFloat(appData.formData.familiasFaixa2) || 0) + 
                                    (parseFloat(appData.formData.familiasFaixa3) || 0)
                                ).toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="result-card">
                        <h4>Análise Competitiva</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span>Concorrentes mapeados:</span>
                                <span>${appData.formData.concorrentes.length}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Preço médio mercado:</span>
                                <span>R$ ${calculateCompetitorAverage('preco')}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="pricing-recommendation">
                    <h4><i class="fas fa-bullseye"></i> Recomendação de Preço</h4>
                    <div class="price-grid">
                        <div class="price-card">
                            <div>Preço Mínimo</div>
                            <div>R$ ${appData.results.precoMinimo.toLocaleString('pt-BR')}</div>
                            <div>Limite para viabilidade</div>
                        </div>
                        <div class="price-card featured">
                            <div>Preço Sugerido</div>
                            <div>R$ ${appData.results.precoSugerido.toLocaleString('pt-BR')}</div>
                            <div>Baseado na estratégia</div>
                        </div>
                        <div class="price-card">
                            <div>Margem Final</div>
                            <div>${appData.results.margemFinal}%</div>
                            <div>Lucro líquido estimado</div>
                        </div>
                    </div>
                </div>
                
                <div class="grid-cols-2">
                    <div class="info-box blue">
                        <h4><i class="fas fa-chart-line"></i> Projeção de Performance</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span>VSO Projetada:</span>
                                <span>${appData.results.vsoProjetada}% ao mês</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Tempo de vendas (100 un):</span>
                                <span>${(100 / appData.results.vsoProjetada).toFixed(0)} meses</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Status VSO:</span>
                                <span class="${appData.results.vsoProjetada >= 2.5 ? 'green-text' : 'red-text'}">
                                    ${appData.results.vsoProjetada >= 3 ? 'Excelente' : 
                                      appData.results.vsoProjetada >= 2.5 ? 'Boa' : 'Baixa'}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-box yellow">
                        <h4><i class="fas fa-exclamation-triangle"></i> Validações Críticas</h4>
                        <div class="space-y-1">
                            <div class="${appData.results.som >= 50 ? 'green-text' : 'red-text'}">
                                <i class="fas ${appData.results.som >= 50 ? 'fa-check-circle' : 'fa-exclamation-triangle'}"></i>
                                <span>SOM vs Demanda ${appData.results.som >= 50 ? '✓' : '✗'}</span>
                            </div>
                            <div class="${appData.results.margemFinal >= 20 ? 'green-text' : 'red-text'}">
                                <i class="fas ${appData.results.margemFinal >= 20 ? 'fa-check-circle' : 'fa-exclamation-triangle'}"></i>
                                <span>Margem Mínima ${appData.results.margemFinal >= 20 ? '✓' : '✗'}</span>
                            </div>
                            <div class="${appData.results.vsoProjetada >= 2 ? 'green-text' : 'red-text'}">
                                <i class="fas ${appData.results.vsoProjetada >= 2 ? 'fa-check-circle' : 'fa-exclamation-triangle'}"></i>
                                <span>VSO Viável ${appData.results.vsoProjetada >= 2 ? '✓' : '✗'}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="gray-box">
                    <h4><i class="fas fa-bullseye"></i> Próximos Passos</h4>
                    <div class="grid-cols-2">
                        <div>
                            <h5>Implementação:</h5>
                            <ul>
                                <li>• Validar preço com equipe comercial</li>
                                <li>• Testar em pré-lançamento limitado</li>
                                <li>• Preparar argumentação de vendas</li>
                                <li>• Definir estratégia de lançamento</li>
                            </ul>
                        </div>
                        <div>
                            <h5>Monitoramento:</h5>
                            <ul>
                                <li>• Acompanhar VSO semanal</li>
                                <li>• Monitorar concorrência</li>
                                <li>• Avaliar ajustes trimestrais</li>
                                <li>• Medir satisfação dos clientes</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="success-box">
                    <div class="flex items-start">
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <h4>Análise Concluída!</h4>
                            <p>
                                Seu framework de precificação está completo. Use as recomendações como base para a decisão final, 
                                sempre considerando fatores específicos do seu projeto e mercado local.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Funções de renderização simplificadas para as outras etapas
        function renderPesquisa() {
            stepContent.innerHTML = `
                <div class="info-box purple">
                    <div class="flex items-start">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <h4>Pesquisa de Intenção de Compra</h4>
                            <p>Valide a sensibilidade ao preço do público-alvo</p>
                        </div>
                    </div>
                </div>
                
                <!-- Conteúdo simplificado para demonstração -->
                <div class="info-box blue">
                    <h4><i class="fas fa-clipboard-list"></i> Como Conduzir a Pesquisa</h4>
                    <div>
                        <p><strong>Pergunta-chave:</strong> "Para uma família com renda de R$ X, qual seria o valor máximo que pagaria por um apartamento de XXm² no bairro Y, considerando financiamento MCMV?"</p>
                        <p><strong>Canais sugeridos:</strong> Stands de vendas, redes sociais, pesquisa telefônica, eventos imobiliários</p>
                        <p><strong>Amostra mínima:</strong> 200+ pessoas da faixa de renda MCMV</p>
                    </div>
                </div>
                
                <div class="grid-cols-3">
                    <div class="input-group">
                        <label>Preço Ideal (R$)</label>
                        <input type="number" id="precoIdeal" 
                            value="${appData.formData.precoIdeal}" 
                            placeholder="Ex: 180000">
                        <p class="input-hint">Preço mais citado na pesquisa</p>
                    </div>
                    
                    <div class="input-group">
                        <label>Preço Máximo Aceitável (R$)</label>
                        <input type="number" id="precoMaximo" 
                            value="${appData.formData.precoMaximo}" 
                            placeholder="Ex: 220000">
                        <p class="input-hint">Limite superior de aceitação</p>
                    </div>
                    
                    <div class="input-group">
                        <label>Preço Suspeito (R$)</label>
                        <input type="number" id="precoSuspeito" 
                            value="${appData.formData.precoSuspeito}" 
                            placeholder="Ex: 150000">
                        <p class="input-hint">Preço considerado "muito barato"</p>
                    </div>
                </div>
                
                <!-- Conteúdo adicional simplificado -->
                <div class="info-box orange">
                    <h4><i class="fas fa-lightbulb"></i> Dicas para Validação</h4>
                    <ul>
                        <li>• Compare resultados com análise competitiva</li>
                        <li>• Teste diferentes perfis de renda na mesma pesquisa</li>
                        <li>• Valide diferencial de preço por localização</li>
                        <li>• Considere sazonalidade na pesquisa (evitar dezembro/janeiro)</li>
                    </ul>
                </div>
            `;
            
            // Event listeners
            document.getElementById('precoIdeal').addEventListener('input', saveFormData);
            document.getElementById('precoMaximo').addEventListener('input', saveFormData);
            document.getElementById('precoSuspeito').addEventListener('input', saveFormData);
        }

        function renderEstrategia() {
            stepContent.innerHTML = `
                <div class="info-box indigo">
                    <div class="flex items-start">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <h4>Estratégia de Precificação</h4>
                            <p>Escolha a abordagem mais adequada para seu projeto</p>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div class="option-card">
                        <label class="option-label">
                            <input type="radio" name="estrategia" value="valor" 
                                ${appData.formData.estrategia === 'valor' ? 'checked' : ''}>
                            <div>
                                <h4 class="green-text">Precificação por Valor</h4>
                                <p>
                                    Preço baseado no valor percebido pelos clientes. Ideal quando você tem diferenciais únicos e superiores à concorrência.
                                </p>
                                <div class="option-hint green-text">
                                    <strong>Quando usar:</strong> Localização premium, acabamentos superiores, infraestrutura diferenciada
                                </div>
                            </div>
                        </label>
                    </div>
                    
                    <!-- Estratégias simplificadas para demonstração -->
                    <div class="option-card">
                        <label class="option-label">
                            <input type="radio" name="estrategia" value="competitiva" 
                                ${appData.formData.estrategia === 'competitiva' ? 'checked' : ''}>
                            <div>
                                <h4 class="blue-text">Precificação Competitiva</h4>
                                <p>
                                    Preço similar ao mercado, competindo em outros fatores como prazo de entrega, facilidade de aprovação ou atendimento.
                                </p>
                                <div class="option-hint blue-text">
                                    <strong>Quando usar:</strong> Mercado estabelecido, produto similar aos concorrentes, foco na execução
                                </div>
                            </div>
                        </label>
                    </div>
                    
                    <div class="option-card">
                        <label class="option-label">
                            <input type="radio" name="estrategia" value="penetracao" 
                                ${appData.formData.estrategia === 'penetracao' ? 'checked' : ''}>
                            <div>
                                <h4 class="orange-text">Precificação de Penetração</h4>
                                <p>
                                    Preço abaixo do mercado para ganhar participação rapidamente. Estratégia de volume com margem reduzida.
                                </p>
                                <div class="option-hint orange-text">
                                    <strong>Quando usar:</strong> Entrada em novo mercado, necessidade de VSO alta, concorrência forte
                                </div>
                            </div>
                        </label>
                    </div>
                </div>
                
                <div class="input-group">
                    <label>Meta de VSO (% estoque/mês)</label>
                    <input type="number" step="0.1" id="vsoMeta" 
                        value="${appData.formData.vsoMeta}" 
                        placeholder="Ex: 2.5">
                    <p class="input-hint">
                        Referência: Mercado normal 2-3%, aquecido 3-5%, fraco 1-2%
                    </p>
                </div>
            `;
            
            // Event listeners
            document.querySelectorAll('input[name="estrategia"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    appData.formData.estrategia = e.target.value;
                });
            });
            
            document.getElementById('vsoMeta').addEventListener('input', saveFormData);
        }
    </script>
</body>
</html>
